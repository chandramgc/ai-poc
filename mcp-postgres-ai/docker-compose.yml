version: '3.8'

services:
  mcp-server:
    build: .
    container_name: mcp-server
    command: python -m src.mcp_server.main
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      POSTGRES_DB: ${POSTGRES_DB:-postgres}
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      WS_HOST: 0.0.0.0
      WS_PORT: 9001
      WS_API_KEY: ${WS_API_KEY:-change-me}
    ports:
      - "${WS_PORT:-9001}:9001"
    networks:
      - mcp-network
    restart: unless-stopped

  agent:
    build: .
    container_name: mcp-agent
    command: python -m uvicorn src.agent.http_api:app --host 0.0.0.0 --port 9002
    environment:
      MCP_HOST: mcp-server
      WS_PORT: 9001
      WS_API_KEY: ${WS_API_KEY:-change-me}
      HTTP_PORT: 9002
      LLM_API_KEY: ${LLM_API_KEY}
      LLM_MODEL: ${LLM_MODEL:-gpt-4o-mini}
      LANGFUSE_PUBLIC_KEY: ${LANGFUSE_PUBLIC_KEY:-}
      LANGFUSE_SECRET_KEY: ${LANGFUSE_SECRET_KEY:-}
      LANGFUSE_HOST: ${LANGFUSE_HOST:-http://localhost:6005}
    ports:
      - "${HTTP_PORT:-9002}:9002"
    depends_on:
      - mcp-server
    networks:
      - mcp-network
    restart: unless-stopped

networks:
  mcp-network:
    driver: bridge
